---
- hosts: localhost
  connection: local
  gather_facts: no
  tasks:
    - name: start
      docker_container:
        name: "{{name}}"
        hostname: "{{name}}"
        image: centos:6
        state: started
        tty: yes
        keep_volumes: no

    - name: add container to inventory
      add_host:
        name: "{{name}}"
        ansible_host: "{{name}}"
        ansible_user: root
        ansible_connection: docker
      changed_when: false
  vars:
      name: test1

- hosts: test1
  gather_facts: no
  tasks:
    - name: Call system test
      jenkins_job:
        host: http://172.17.0.2:8080
        job: /job/test1
        token: token1
        params:
        username: admin
        password: 57033f8c2abc058d3b154cd79735f012
        force_basic_auth: yes

- hosts: localhost
  connection: local
  gather_facts: no
  tasks:
    - name: destroy build container
      docker_container:
        name: "{{name}}"
        state: absent
  vars:
      name: test1
